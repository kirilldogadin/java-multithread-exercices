Явное и безопасное завершение


ЗАДАЧА:
1.Логика/метод который дает время на "мягкое завершение", если оно не происходит , то выполнить жесткое

МОЖНО использовать метод invokeAll, нужно понимать, что он блокирующий

Между клиентскими потоками и пулом потоков лежит очередь заданий. Когда приложение завершает работу, вы должны побеспокоиться о двух вещах: что произойдет с заданиями, ожидающими в очереди, и как поведут себя уже выполняющиеся (об этом позже). Удивительно, но многие разработчики не закрывают пул потоков должным образом. Есть два способа: либо разрешите отработать всем задачам в очереди (shutdown()), либо удалите их (shutdownNow()) – в зависимости от конкретного случая. Например, если мы поставили в очередь набор задач и хотим вернуть управление как только все они выполнятся, используем shutdown():

В этом примере мы отправляем пачку писем, каждое в виде отдельного задания для пула 
потоков. После постановки этих заданий в очередь мы закрываем пул, 
чтобы он больше не мог принять новых задач. 
Далее мы ждем максимум одну минуту пока все задания не будут выполнены. Однако, 
если какие-то задания еще не выполнены, awaitTermination() просто вернет false. 
Кроме того, оставшиеся задания продолжат выполняться.


Альтернатива постепенному завершению shutdown() – это shutdownNow():
final List<Runnable> rejected = executorService.shutdownNow();
log.debug("Отклоненные задачи: {}", rejected.size());

На этот раз все стоящие в очереди задачи отбрасываются и возвращаются. Уже запущенным задачам разрешено продолжить работу.